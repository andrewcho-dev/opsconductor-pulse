{% extends "customer/base.html" %}

{% block title %}Device {{ device_id }} - OpsConductor Pulse{% endblock %}

{% block head %}
<meta http-equiv="refresh" content="{{ refresh }}">
{% endblock %}

{% block content %}
<div class="breadcrumb">
  <a href="/customer/dashboard">Dashboard</a> &gt;
  <a href="/customer/devices">Devices</a> &gt;
  {{ device_id }}
</div>

<div class="small">Auto-refresh: {{ refresh }}s</div>

{% if dev %}
  <div class="pill">Site: <b>{{ dev.site_id }}</b></div>
  <div class="pill {{ dev.status }}">Status: <b>{{ dev.status }}</b></div>
  <div class="pill">Last Seen: <b>{{ dev.last_seen_at }}</b></div>
  <div class="pill">Battery: <b>{{ dev.battery_pct }}</b></div>
  <div class="pill">Temp: <b>{{ dev.temp_c }}</b></div>
  <div class="pill">RSSI: <b>{{ dev.rssi_dbm }}</b></div>
  <div class="pill">SNR: <b>{{ dev.snr_db }}</b></div>
{% else %}
  <div class="small">No device_state row found yet for {{ device_id }}.</div>
{% endif %}

<h2>Charts (last ~120 accepted telemetry points)</h2>

<div class="chartbox">
  <div class="small"><b>Battery%</b></div>
  <svg width="540" height="70">
    <polyline fill="none" stroke="#8ab4f8" stroke-width="2" points="{{ charts.battery_pts }}"></polyline>
  </svg>
</div>

<div class="chartbox">
  <div class="small"><b>Temp C</b></div>
  <svg width="540" height="70">
    <polyline fill="none" stroke="#2a9d8f" stroke-width="2" points="{{ charts.temp_pts }}"></polyline>
  </svg>
</div>

<div class="chartbox">
  <div class="small"><b>RSSI (dBm)</b></div>
  <svg width="540" height="70">
    <polyline fill="none" stroke="#e76f51" stroke-width="2" points="{{ charts.rssi_pts }}"></polyline>
  </svg>
</div>

<h2>Last 50 Events</h2>
{% if events|length == 0 %}
  <div class="small">No events found.</div>
{% else %}
<table>
  <thead>
    <tr>
      <th>Ingested</th>
      <th>Accepted</th>
      <th>Site</th>
      <th>Type</th>
      <th>Reject Reason</th>
    </tr>
  </thead>
  <tbody>
    {% for e in events %}
    <tr>
      <td>{{ e.ingested_at }}</td>
      <td><b>{{ e.accepted }}</b></td>
      <td>{{ e.site_id }}</td>
      <td>{{ e.msg_type }}</td>
      <td>{{ e.reject_reason }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endif %}
{% endblock %}
