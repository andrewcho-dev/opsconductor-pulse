{% extends "customer/base.html" %}

{% block title %}Device {{ device_id }} - OpsConductor Pulse{% endblock %}

{% block head %}
<script src="/static/js/device_charts.js" defer></script>
{% endblock %}

{% block content %}
<div id="device-page" data-device-id="{{ device_id }}">

<div class="breadcrumb">
  <a href="/customer/dashboard">Dashboard</a> &gt;
  <a href="/customer/devices">Devices</a> &gt;
  {{ device_id }}
</div>

{% if dev %}
  <div class="metric-pills">
    <div class="pill">Site: <b>{{ dev.site_id }}</b></div>
    <div class="pill {{ dev.status }}">Status: <b>{{ dev.status }}</b></div>
    <div class="pill">Last Seen: <b>{{ dev.last_seen_at }}</b></div>
    {% if dev.battery_pct is not none %}<div class="pill">Battery: <b>{{ dev.battery_pct }}%</b></div>{% endif %}
    {% if dev.temp_c is not none %}<div class="pill">Temp: <b>{{ dev.temp_c }}Â°C</b></div>{% endif %}
    {% if dev.rssi_dbm is not none %}<div class="pill">RSSI: <b>{{ dev.rssi_dbm }} dBm</b></div>{% endif %}
    {% if dev.snr_db is not none %}<div class="pill">SNR: <b>{{ dev.snr_db }} dB</b></div>{% endif %}
  </div>
{% else %}
  <div class="small">No device_state row found yet for {{ device_id }}.</div>
{% endif %}

<h2>Telemetry Charts</h2>

<div class="time-range-controls">
  <button data-range="1h">1h</button>
  <button data-range="6h">6h</button>
  <button data-range="24h">24h</button>
  <button data-range="7d">7d</button>
</div>

<div id="metric-charts" class="metric-charts">
  <div class="small">Loading charts...</div>
</div>

<h2>Last 50 Events</h2>
{% if events|length == 0 %}
  <div class="small">No events found.</div>
{% else %}
<table>
  <thead>
    <tr>
      <th>Ingested</th>
      <th>Accepted</th>
      <th>Site</th>
      <th>Type</th>
      <th>Reject Reason</th>
    </tr>
  </thead>
  <tbody>
    {% for e in events %}
    <tr>
      <td>{{ e.ingested_at }}</td>
      <td><b>{{ e.accepted }}</b></td>
      <td>{{ e.site_id }}</td>
      <td>{{ e.msg_type }}</td>
      <td>{{ e.reject_reason }}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endif %}

</div>
{% endblock %}
