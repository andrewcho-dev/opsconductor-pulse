# acl.conf -- OpsConductor-Pulse topic access control
#
# Username formats:
#   - Certificate-authenticated (port 8883): CN = "{tenant_id}/{device_id}"
#   - Password-authenticated (port 1883): username = "service_pulse" or device client_id
#
# With use_identity_as_username, %u = full CN for cert devices.
# Since CN contains '/', and topics use 'tenant/{t}/device/{d}/...', we cannot
# use %u directly in topic patterns. Instead, ingest_iot enforces topic isolation.
# ACL provides coarse access control.

# Platform service account (internal, port 1883)
user service_pulse
topic readwrite #

# Certificate-authenticated devices get broad write access to telemetry topics.
# Fine-grained tenant/device isolation is enforced by ingest_iot which parses
# the topic and validates it against the device registry + active certificates.

# Allow devices to write telemetry/shadow/ack
pattern write tenant/+/device/+/telemetry/#
pattern write tenant/+/device/+/shadow/reported
pattern write tenant/+/device/+/commands/ack

# Allow devices to read desired shadow/commands/jobs
pattern read tenant/+/device/+/shadow/desired
pattern read tenant/+/device/+/commands
pattern read tenant/+/device/+/jobs/#

