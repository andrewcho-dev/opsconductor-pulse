# Phase 79 — Runtime Fix: 500s and 404s After Phase 75–78

## Step 1: Check actual error in ui_iot container

```bash
docker compose logs ui_iot --tail=50 2>&1
```

Look for `ImportError`, `ModuleNotFoundError`, `asyncpg` errors, or Python tracebacks.

## Step 2: Rebuild and restart services with updated dependencies

```bash
docker compose build ui_iot && docker compose up -d ui_iot
```

This installs `passlib[bcrypt]` (added in Phase 75) and picks up all new route code.

## Step 3: Apply pending migrations

```bash
docker compose exec ui_iot python -m db.migrate
```

OR however migrations are applied in this project. Check `Makefile` or `docker-compose.yml` for the migration command pattern. Run migrations for 064 (device_api_tokens) and 065 (alert_digest_settings).

## Step 4: Verify routes are live

```bash
curl -s -o /dev/null -w "%{http_code}" http://localhost/customer/subscriptions -H "Authorization: Bearer <token>"
curl -s -o /dev/null -w "%{http_code}" http://localhost/customer/fleet/uptime-summary -H "Authorization: Bearer <token>"
curl -s -o /dev/null -w "%{http_code}" http://localhost/customer/maintenance-windows -H "Authorization: Bearer <token>"
curl -s -o /dev/null -w "%{http_code}" http://localhost/customer/device-groups -H "Authorization: Bearer <token>"
```

All should return 200 or 401 (not 500 or 404).

## Step 5: If still 500 on /customer/subscriptions

Check whether migration 064 applied cleanly:
```bash
docker compose exec db psql -U postgres -d simcloud -c "\d device_api_tokens"
```

If the table doesn't exist, the migration didn't run. Apply it manually:
```bash
docker compose exec db psql -U postgres -d simcloud -f /migrations/064_device_api_tokens.sql
```

## Step 6: Report

- Output of `docker compose logs ui_iot --tail=50`
- HTTP status of each curl check
- Whether migrations applied cleanly
