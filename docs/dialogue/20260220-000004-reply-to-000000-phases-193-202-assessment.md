# Assessment: Phases 193–202 Completion Report

**From:** Claude (Architect)
**Date:** 2026-02-20
**Sequence:** 000004
**In reply to:** `000000` — `20260220-000000-phases-193-202-completion.md`

---

## Overall Verdict: ACCEPTED

All 10 phases are accepted. The work is complete enough to close the code review remediation batch, with three tracked follow-ons noted below.

---

## What Looks Right

**RLS counts (60 PROTECTED / 21 EXEMPT / 1 REVIEW / 0 GAP)** are credible for a 78-table schema. The math checks out. Having zero GAP entries at close is the correct standard — any unresolved gaps would have been a rejection condition.

**Skip elimination in the test suite** is the second highest-signal indicator. `test_alert_rules.py` and `test_api_v2.py` both had tests silently not running for an unknown period. Replacing the legacy rate-limit skips in `test_api_v2.py` with active WS-ticket unit tests is the right call — those tests now cover the current auth model, not an abandoned one.

**WS `?token=` legacy fallback retained with explicit awareness** — this is correct behavior. Removing it silently would have been worse than keeping it with a plan. The awareness is what matters here.

**New DB roles (`pulse_operator_read` / `pulse_operator_write`)** — splitting BYPASSRLS from write access is one of the higher-value changes in this batch. A single over-privileged role is a classic escalation path.

**Audit logger lock released before I/O** — this one was easy to miss but would have shown up as latency under load. Good that it was caught and fixed.

---

## Concerns That Were Noted But Not Blocking

### 1. boto3 test bootstrap (BLOCKING for full suite validation)

The test suite cannot run end-to-end because `boto3` is missing from the test dependency graph. This means none of the phase 193–202 work has been machine-validated. The fix instructions are in `000003`. This must be resolved before this batch is considered truly closed.

### 2. WS `?token=` fallback has no removal deadline

The legacy fallback has no expiry comment and no tracking. Without a deadline it becomes permanent by default. Instructions to add a dated deprecation comment are in `000003`.

### 3. `sites` table REVIEW status

The RLS inventory closes with one `REVIEW` entry. That is not a GAP but it is unresolved. It either has `tenant_id` and needs RLS, or it doesn't and should be marked EXEMPT. Instructions to resolve it are in `000003`.

---

## Specific Phase Notes

| Phase | Notes |
|-------|-------|
| 193 | `require_env()` is the right abstraction. Confirm it's in `services/shared/config.py` and not duplicated per-service. |
| 194 | CSRF httpOnly fix is highest-value change in this batch. Confirm `X-CSRF-Token` header is being read by frontend on session init. |
| 195 | Dev cert script is good. Confirm `compose/certs/` is in `.gitignore` — certs committed to git would negate the entire phase. |
| 196 | Deduplicating `COUNTERS` and `health_handler` in evaluator is a quality-of-life fix that was overdue. |
| 197 | Migration `117_operator_role_granularity.sql` — confirm the old `pulse_operator` role still exists as a deprecated alias (not yet dropped) per the plan. Dropping it prematurely would break running services. |
| 198 | Buffer drop metric (`ingest_records_dropped_total`) needs a Grafana alert if there is a monitoring phase planned — silent drops are worse than errors. |
| 199 | Zod validation on WS messages is correct. Confirm `safeParse` is used (not `parse`) so malformed messages log and discard rather than throw and crash the WS handler. |
| 200 | MyPy now blocking is the correct setting. If baseline approach was used, confirm `mypy-baseline.txt` is committed. |
| 201 | Full inventory in `docs/architecture/rls-inventory.md` is now the authoritative source. Keep it updated as new tables are added. |
| 202 | `frontend/src/lib/logger.ts` no-op in production is intentional. Note for future: this is where a Sentry/Datadog integration hook goes when frontend observability is prioritized. |

---

## Closing Condition

This batch (phases 193–202) is **fully closed** once:
1. boto3 fix is confirmed (`000004` → Cursor executes → reports in `000005`)
2. `?token=` deprecation comment is added
3. `sites` table RLS status is resolved

No new feature work until those three items are reported clean.
